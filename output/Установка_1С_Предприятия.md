# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ 1–° –ü—Ä–µ–¥–ø—Ä–∏—è—Ç–∏—è 8.2

## –í–≤–µ–¥–µ–Ω–∏–µ

–í –¥–∞–Ω–Ω–æ–º —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–µ –æ–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–ª–∏–µ–Ω—Ç-—Å–µ—Ä–≤–µ—Ä–Ω–æ–≥–æ 1–°
–ü—Ä–µ–¥–ø—Ä–∏—è—Ç–∏—è 8.2 –≤ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—É—é –º–∞—à–∏–Ω—É —Å –û–° –Ω–∞ –æ—Å–Ω–æ–≤–µ —è–¥—Ä–∞ linux.
–¢.–∫. —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ 1–° –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–∏–∫–∞–∫–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –ø–æ
—É—Å—Ç–∞–Ω–æ–≤–∫–µ, –∫—Ä–æ–º–µ –Ω–∞–∑–≤–∞–Ω–∏—è –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –±–∏–Ω–∞—Ä–Ω—ã—Ö –ø–∞–∫–µ—Ç–æ–≤, –∞ –≤ —Å–µ—Ç–∏,
—Å—Ä–µ–¥–∏ –Ω–µ–±–æ–ª—å—à–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –ø–æ —Ç–µ–º–µ, –Ω–µ –±—ã–ª–æ –Ω–∞–π–¥–µ–Ω–æ
–ø–æ–ª–Ω–æ–≥–æ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–∞, –∫–æ—Ç–æ—Ä–æ–µ –±—ã –æ–ø–∏—Å—ã–≤–∞–ª–æ –ø—Ä–æ—Ü–µ—Å—Å –æ—Ç –Ω–∞—á–∞–ª–∞ –∏ –¥–æ
–∫–æ–Ω—Ü–∞, —Ç–æ –ø–æ—è–≤–∏–ª–∞—Å—å –∏–¥–µ—è –æ–ø–∏—Å–∞—Ç—å –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —à–∞–≥–∏ –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ.
–û–° —Ö–æ–∑—è–∏–Ω–∞ –∏–º–µ–µ—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É amd64, –∞ 1–° –∏ –∫–ª—é—á–∏ 32-–±–∏—Ç–Ω—ã–µ, –ø–æ—ç—Ç–æ–º—É –û–°
–≤ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ –±—É–¥–µ—Ç —Å i386 –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π. –ò —Ç–∞–∫, –∏–º–µ–µ—Ç—Å—è:

  - —Å–µ—Ä–≤–µ—Ä —Å Debian GNU/Linux 6 (amd64);
  - 2 usb-–∫–ª—é—á–∞ —Å –ª–∏—Ü–µ–Ω–∑–∏—è–º–∏: –æ–¥–∏–Ω - –¥–ª—è —Å–µ—Ä–≤–µ—Ä–∞, –≤—Ç–æ—Ä–æ–π - —Å–µ—Ç–µ–≤–æ–π –¥–ª—è
    –∫–ª–∏–µ–Ω—Ç–æ–≤;
  - –Ω–∞–±–æ—Ä \*.deb –ø–∞–∫–µ—Ç–æ–≤ 1–° (i386);

<div style="font-style: italic; margin-left: 2em">

–¢.–∫. —Å—Ç–∞—Ç—å—è –ø–∏—Å–∞–ª–∞—Å—å —á–µ—Ä–µ–∑ –∫–∞–∫–æ–µ-—Ç–æ –≤—Ä–µ–º—è –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏, –∞ –ø—Ä–æ–≤–µ—Ä—è—Ç—å
–≤—Å—ë –∑–∞–Ω–æ–≤–æ –Ω–∞ –±–æ–µ–≤–æ–π –º–∞—à–∏–Ω–µ –Ω–∏–∫–∞–∫–æ–≥–æ –∂–µ–ª–∞–Ω–∏—è –Ω–µ—Ç, —Ç–æ –º–æ–≥—É—Ç –±—ã—Ç—å –Ω–µ
—Ç–æ—á–Ω–æ—Å—Ç–∏ –∏ –æ—à–∏–±–∫–∏.

</div>

## –°–±–æ—Ä–∫–∞ postgresql

–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Ä–∞—Å–ø–∞–∫–æ–≤–∞—Ç—å –∏—Å—Ö–æ–¥–Ω–∏–∫–∏ postgresql –≤–æ –≤—Ä–µ–º–µ–Ω–Ω—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é:

    user@linux$ apt-get source postgresql-8.4
    user@linux$ cd postgresql-8.4-8.4.13

–ü–æ—Å–ª–µ, —Å–∫–∞—á–∞—Ç—å —Ç—Ä–∏ –ø–∞—Ç—á–∞ –¥–ª—è postgresql 8.4.1 —Å
[—Å–∞–π—Ç–∞ 1–°](http://v8.1c.ru/overview/postgres_patches_notes.htm) –∏
—Ä–∞–∑–º–µ—Å—Ç–∏—Ç—å –∏—Ö –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —Å –∏—Å—Ö–æ–¥–Ω–∏–∫–∞–º–∏:

    user@linux$ mv ~/1c_FULL_84-0.19.2.patch debian/patches/20-1c_FULL_84-0.19.2.patch
    user@linux$ mv ~/postgresql-1c-8.4.patch debian/patches/21-postgresql-1c-8.4.patch
    user@linux$ mv ~/applock-1c-8.4.1.patch debian/patches/22-applock-1c-8.4.1.patch

–í <span style="font-family: monospace">debian/rules</span> –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ
–∏—Å–ø—Ä–∞–≤–∏—Ç—å **--enable-integer-datatime** –Ω–∞
**--disable-integer-datatime**. –í
<span style="font-family: monospace">debian/postgresql-contrib-8.4.install</span>
–Ω–∞–¥–æ –¥–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫–∏:

    usr/lib/postgresql/8.4/lib/mchar.so
    usr/lib/postgresql/8.4/lib/fulleq.so
    usr/lib/postgresql/8.4/lib/fasttrun.so

–ü–µ—Ä–µ–¥ —Å–±–æ—Ä–∫–æ–π –ø–∞–∫–µ—Ç–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫—Ä–æ–º–µ –ø—Ä–æ—á–µ–≥–æ, —Ç–∞–∫–∂–µ, –∏
<span style="font-family: monospace">libicu-dev</span>. –ü–æ—Å–ª–µ —á–µ–≥–æ –º–æ–∂–Ω–æ
–∑–∞–ø—É—Å–∫–∞—Ç—å —Å–±–æ—Ä–∫—É –ø–∞–∫–µ—Ç–∞ —Å –ø–æ–º–æ—â—å—é dpkg-buildpackage.

<div style="margin-left: 2em; font-style: italic">

–í –º–æ—ë–º —Å–ª—É—á–∞–µ gcc —Ä—É–≥–∞–ª—Å—è –≤ –¥–≤—É—Ö –º–µ—Å—Ç–∞—Ö –Ω–∞ –Ω–µ–æ–±—ä—è–≤–ª–µ–Ω–Ω—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é
<span style="font-family: monospace">rest</span>. –î–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —ç—Ç–æ–≥–æ
–≤ –Ω–∞—á–∞–ª–æ —Ñ—É–Ω–∫—Ü–∏–∏, –≥–¥–µ –≤–æ–∑–Ω–∏–∫–ª–∞ –æ—à–∏–±–∫–∞, –Ω–∞–¥–æ –¥–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É:

    Const      *rest = NULL;

</div>

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–∞–∑–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã

### –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Å–∫–∞ –∏ –§–° –¥–ª—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã

–°–æ–∑–¥–∞—ë–º –æ–±—Ä–∞–∑—ã –¥–∏—Å–∫–æ–≤:

    user@linux$ kvm-img create -f raw acc.img 4G
    user@linux$ kvm-img create -f raw acc.db.img 8G

–ê—Å—Å–æ—Ü–∏–∏—Ä—É–µ–º –æ–±—Ä–∞–∑ —Å loopback-—É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ–º:

    root@linux# losetup /dev/loop0 ./acc.img

–°–æ–∑–¥–∞—ë–º –Ω–∞ –¥–∞–Ω–Ω–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ –æ–¥–∏–Ω —Ä–∞–∑–¥–µ–ª, –∫–æ—Ç–æ—Ä—ã–π –∞—Å—Å–æ—Ü–∏–∏—Ä—É–µ–º —Å
/dev/loop1. –ü–æ—Å–ª–µ —á–µ–≥–æ —Å–æ–∑–¥–∞—ë–º —Ñ–∞–π–ª–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É –Ω–∞ –Ω—ë–º (–ø–µ—Ä–µ–¥–∞–≤–∞—è mkfs
–∫–æ–ª-–≤–æ –±–ª–æ–∫–æ–≤ –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ 4192933):

    root@linux# fdisk /dev/loop0
    root@linux# losetup -o $((63*512)) /dev/loop1 ./acc.img
    root@linux# mkfs.ext3 /dev/loop1 4192933
    root@linux# tune2fs -L rootfs /dev/loop1

–£–∑–Ω–∞—Ç—å —Å–º–µ—â–µ–Ω–∏–µ –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ —Ä–∞–∑–¥–µ–ª–∞, –∞ —Ç–∞–∫–∂–µ –∫–æ–ª-–≤–æ –±–ª–æ–∫–æ–≤ –∑–∞–Ω–∏–º–∞–µ–º—ã—
–∏–º, –º–æ–∂–Ω–æ —Å –ø–æ–º–æ—â—å—é –∫–æ–º–∞–Ω–¥—ã:

    root@linux# fdisk -lu /dev/loop0

    Disk /dev/loop0: 4294 MB, 4294967296 bytes
    255 heads, 63 sectors/track, 522 cylinders, total 8388608 sectors
    Units = sectors of 1 * 512 = 512 bytes
    Sector size (logical/physical): 512 bytes / 512 bytes
    I/O size (minimum/optimal): 512 bytes / 512 bytes
    Disk identifier: 0x390981ce

          Device Boot      Start         End      Blocks   Id  System
    /dev/loop0p1              63     8385929     4192933+  83  Linux

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–∞–∑–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã

–°—Ç–∞–≤–∏–º –±–∞–∑–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É —Å –ø–æ–º–æ—â—å—é debootstrap:

    root@linux# mount /dev/loop1 /mnt
    root@linux# debootstrap --arch=i386 --foreign --include=grub2 squeeze /mnt http://ftp.debian.org

–°—Ç–∞–≤–∏–º —è–¥—Ä–æ:

    root@linux# (cd /; tar -c /boot/*3.2.30-my /lib/modules/3.2.30-my) | (cd /mnt; tar -x )

–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º grub2:

    root@linux# grub-install --modules=part_msdos --root-directory=/mnt /dev/loop0

–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –Ω–∞–¥–æ —Å–æ–∑–¥–∞—Ç—å
<span style="font-family: monospace">/mnt/boot/grub/grub.cfg</span>.
–ú–æ–∂–Ω–æ –ø—Ä–æ—Å—Ç–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–π –∏ –¥–æ–±–∞–≤–∏—Ç—å —Ç—É–¥–∞ –Ω–æ–≤—ã–π –ø—É–Ω–∫—Ç –º–µ–Ω—é
–≤–∏–¥–∞:

    menuentry 'Debian GNU/Linux, with Linux 3.2.30-my' --class debian --class gnu-linux --class gnu --class os {
            insmod part_msdos
            insmod ext2
            search --no-floppy --label rootfs --set=root
            echo    'Loading Linux 3.2.30-my ...'
            linux   /boot/vmlinuz-3.2.30-my root=LABEL=rootfs console=ttyS0 ro  quiet
            echo    'Loading initial ramdisk ...'
            initrd  /boot/initrd.img-3.2.30-my
    }

–ò–ª–∏ –º–æ–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ lilo –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã grub2:

    root@linux# echo "
    boot=/dev/loop0
    disk=/dev/loop0
            bios=0x80
            cylinders=522
            heads=255
            sectors=63
            partition=/dev/loop1
                    start=1
    install=menu
    prompt
    timeout=100
    lba32
    large-memory

    image=/boot/vmlinuz-3.2.30-my
            initrd="/boot/initrd.img-3.2.30-my"
            append="console=ttyS0"
            root="LABEL=rootfs"
            label=linux
    " > /mnt/etc/lilo.conf
    root@linux# lilo -r /mnt

–î–ª—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∑–∞–ª–æ–≥–∏–Ω–∏—Ç—å—Å—è —Å –ø–æ–º–æ—â—å—é telnet –Ω–∞ ttyS0 —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–µ–º –≤
<span style="font-family: monospace">/mnt/etc/inittab</span> —Å–ª–µ–¥—É—é—â—É—é
—Å—Ç—Ä–æ–∫—É:

    T0:23:respawn:/sbin/getty -L ttyS0 9600 vt100

–î–æ–±–∞–≤–∏–º –º–æ–¥—É–ª—å —è–¥—Ä–∞ button –≤
<span style="font-family: monospace">/mnt/etc/modules</span>:

    root@linux# echo button >> /mnt/etc/modules

### –ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –±–∞–∑–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã –∏–∑ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã

–¢–µ–ø–µ—Ä—å –Ω–∞–¥–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω—É—é –º–∞—à–∏–Ω—É –∏ –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –Ω–µ–π –ø–æ vnc,
—á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —É—Å—Ç–∞–Ω–æ–≤–∫—É –±–∞–∑–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã. –í –º–æ—ë–º —Å–ª—É—á–∞–µ —Å–∫—Ä–∏–ø—Ç
–∑–∞–ø—É—Å–∫–∞ —Å–ª–µ–¥—É—é—â–∏–π:

    #!/bin/bash

    USBKEY1=`grep -EB 4 '^S:.*HASP 2.17' /proc/bus/usb/devices | awk '$0 ~ /^T:/ { split($2, a, /=/); print a[2] "." $8 }'`
    USBKEY2=`grep -EB 4 '^S:.*HASP HL 3.21' /proc/bus/usb/devices | awk '$0 ~ /^T:/ { split($2, a, /=/); print a[2] "." $8 }'`
    PIDFILE="/var/run/kvm/srv1c.pid"

    CMD="-enable-kvm \
    -cpu host \
    -smp 2 \
    -m 2G \
    -nographic -daemonize \
    -net nic,vlan=0,macaddr=52:54:00:00:00:03,model=virtio -net tap,vlan=0,ifname=tap2,script=no \
    -drive file=acc.img,if=virtio \
    -drive file=acc.db.img,if=virtio \
    -usb \
    -usbdevice host:$USBKEY1 -usbdevice host:$USBKEY2 \
    -vnc 192.168.100.203:2 \
    -monitor unix:acc.mon,server,nowait \
    -serial telnet:127.0.0.2:23,server,nowait \
    -pidfile $PIDFILE"

    case "$1" in
            start)
                    kvm $CMD
                    ip link set dev tap2 up
                    brctl addif br0 tap2
                    ;;
            stop)
                    socat - unix-connect:acc.mon <<EOF
    system_powerdown
    EOF
                    brctl delif br0 tap2
                    ;;
    esac

–ü–æ—Å–ª–µ —á–µ–≥–æ –º–æ–∂–Ω–æ –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –ø–æ vnc –∫ 192.168.100.203:2. –ù—É–∂–Ω–æ–µ —è–¥—Ä–æ(–≤
–¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ 3.2.30-my) –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å
<span style="font-family: monospace">init=/bin/bash</span>. –ö–æ–≥–¥–∞
–∑–∞–≥—Ä—É–∑–∫–∞ –∑–∞–≤–µ—Ä—à–∏–ª–∞—Å—å –Ω–∞–¥–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–∞—Ä–æ–ª—å –¥–ª—è root:

    root@linux# mount -o remount,rw /
    root@linux# passwd

–ò –∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏:

    root@linux# cd debootstrap; ./debootstrap --second-stage
    root@linux# sync

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–æ—á–µ–≥–æ –ü–û

–î–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫—É —Å–µ—Ç–∏:

    root@linux# echo "
    auto lo eth0

    iface lo inet loopback

    iface eth0 inet static
            address 192.168.100.202
            netmask 255.255.255.0
            gateway 192.168.100.201
    " > /etc/network/interfaces
    root@linux# ifup -a

–ò –Ω–∞—Å—Ç—Ä–æ–π–∫—É apt:

    root@linux# echo '
    deb http://ftp.debian.org squeeze main contrib non-free
    deb http://security.debian.org squeeze/updates main contrib non-free
    ' > /etc/apt/sources.list
    root@linux# apt-get update

–î–∞–ª–µ–µ —Å—Ç–∞–≤–∏–º –Ω—É–∂–Ω—ã–µ –ø–∞–∫–µ—Ç—ã:

    root@linux# apt-get install sudo openssh-server acpid zip unzip bzip2 lsb-release openssl ssl-cert openssl-blacklist \
    less libicu44 libossp-uuid16 libldap-2.4-2 libxml2 locales libxslt1.1 \
    imagemagick msttcorefonts libgsf-1-114

–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –Ω–∞–¥–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ª–æ–∫–∞–ª–∏. –î–ª—è —ç—Ç–æ–≥–æ –Ω–∞–¥–æ —Ä–∞—Å–∫–æ–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å
ru_RU.utf-8 –∏ en_US.utf-8 –ª–æ–∫–∞–ª–∏ –≤
<span style="font-family: monospace">/etc/locale.gen</span> –∏ —Å–æ–∑–¥–∞—Ç—å
–≤—Ä—É—á–Ω—É—é –ª–æ–∫–∞–ª—å en_US.utf-8 —Å –ø–æ–º–æ—â—å—é localedef:

    root@linux# locale-gen
    root@linux# echo LANG=ru_RU.utf-8 > /etc/default/locale
    root@linux# localedef -i en_US -f UTF-8 /usr/lib/locale/en_US.UTF-8
    root@linux# cd /usr/lib/locale
    root@linux# ln -s en_US.UTF-8 en_US
    root@linux# ln -s en_US en

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ postgresql

–°–æ–∑–¥–∞—ë–º —Ä–∞–∑–¥–µ–ª –∏ —Ñ–∞–π–ª–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É –Ω–∞ –¥–∏—Å–∫–µ –¥–ª—è –ë–î:

    root@linux# fdisk /dev/vdb
    root@linux# mkfs.ext3 /dev/vdb1
    root@linux# tune2fs -L dbfs /dev/vdb1

–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º /etc/fstab:

    root@linux# mkdir /var/lib/postgresql
    root@linux# echo '
    LABEL=rootfs      /      ext3   auto,errors=remount-ro   0 1
    LABEL=dbfs      /var/lib/postgresql      ext3   auto   0 1
    usbfs /proc/bus/usb usbfs auto 0 0
    ' > /etc/fstab
    root@linux# mount -a

–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã sysctl:

    root@linux# echo "kernel.shmmax = 67108864" >> /etc/sysctl.conf
    root@linux# sysctl -p

–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –º–æ–∂–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å postgresql:

    root@linux# apt-get install postgresql-common postgresql-client-common
    root@linux# dpkg -i libpq5_8.4.13-0squeeze1_i386.deb
    root@linux# dpkg -i libpgtypes3_8.4.13-0squeeze1_i386.deb
    root@linux# dpkg -i postgresql-client-8.4_8.4.13-0squeeze1_i386.deb
    root@linux# dpkg -i postgresql-8.4_8.4.13-0squeeze1_i386.deb
    root@linux# dpkg -i postgresql-contrib-8.4_8.4.13-0squeeze1_i386.deb

–ò —Å–æ–∑–¥–∞–≤–∞—Ç—å –∫–ª–∞—Å—Ç–µ—Ä:

    root@linux# pg_dropcluster --stop 8.4 main
    root@linux# pg_createcluster --locale=ru_RU.utf-8 -e utf-8 --start 8.4 main
    root@linux# sudo -u postgres psql template1
    template1=# create language plpgsql;
    template1=# \i /tmp/mchar.sql
    template1=# \i /tmp/fulleq.sql
    template1=# \i /tmp/fasttrun.sql
    template1=# \i /tmp/plpgsql_call_handler.sql
    template1=# \i /tmp/datediff.sql
    template1=# alter user postgres password 'postgres';

–ì–¥–µ, <span style="font-family: monospace">mchar.sql</span>,
<span style="font-family: monospace">fulleq.sql</span> –∏
<span style="font-family: monospace">fasttrun.sql</span> –Ω–∞–¥–æ –≤–∑—è—Ç—å –∏–∑
–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —Å –∏—Å—Ö–æ–¥–Ω–∏–∫–∞–º–∏ postgresql –∏–∑ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
<span style="font-family: monospace">contrib/mchar</span>,
<span style="font-family: monospace">contrib/fulleq</span> –∏
<span style="font-family: monospace">contrib/fasttrun</span>
—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ. <span style="color: red">–î–æ–±–∞–≤–∏—Ç—å —Å—Å—ã–ª–∫–∏ –Ω–∞
plpgsql_call_handler.sql –∏ datediff.sql</span>.

–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –Ω–∞–¥–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ postgresql —á–µ—Ä–µ–∑ tcp/ip,
—Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–≤ —Å—Ç—Ä–æ–∫—É:

    host    all         all         127.0.0.1/32          md5

–≤ —Ñ–∞–π–ª–µ
<span style="font-family: monospace">/etc/postgresql/8.4/main/pg_hba.conf</span>.

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ postgresql

–ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ —à—Ç–∞—Ç–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∂–µ–ª–∞—Ç—å –ª—É—á—à–µ–≥–æ. –î–∞–ª–µ–µ –ø—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–ª—è —Å–µ—Ä–≤–µ—Ä–∞
—Å 4G –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–º—è—Ç–∏:

    shared_buffers = 256MB
    temp_buffers = 32MB
    work_mem = 20MB
    maintenance_work_mem = 60MB
    max_fsm_pages = 1024000
    max_fsm_relations = 5000
    #---
    fsync = on
    synchronous_commit = off
    full_page_writes = off
    wal_buffers = 512kB
    checkpoint_segments = 12
    checkpoint_timeout = 15min
    random_page_cost = 1.5
    effective_cache_size = 256MB
    #---
    escape_string_warning = off

–ü–æ–¥—Ä–æ–±–Ω–µ–µ –ø—Ä–æ –≤–ª–∏—è–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –Ω–∞ —Å–∞–π—Ç–µ
\[<http://www.gilev.ru/1c/81/postgresql/index.htm>| –í—è—á–µ—Å–ª–∞–≤–∞ –ì–∏–ª—ë–≤–∞\].

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ü–û usb-–∫–ª—é—á–µ–π

–î–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ü–û usb-–∫–ª—é—á–µ–π –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–∫–∞—á–∞—Ç—å –∞—Ä—Ö–∏–≤ —Å —Å–∞–π—Ç–∞
–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—è -
[aladdin.com](ftp://ftp.aladdin.com/pub/hasp/hl/linux/HASP_HL_Linux.tar.gz).
–ü—Ä–æ–≤–µ—Ä–µ–Ω—ã –Ω–∞ —Å–æ–≤–º–µ—Å—Ç–Ω—É—é —Ä–∞–±–æ—Ç—É hasplm 8.30 –∏ aksusbd 1.8.1. –ü–æ—Å–ª–µ —Ç–æ–≥–æ,
–∫–∞–∫ –¥–∞–Ω–Ω—ã–π –∞—Ä—Ö–∏–≤ —Ä–∞—Å–ø–∞–∫–æ–≤–∞–Ω, –º–æ–∂–Ω–æ –ø—Ä–∏—Å—Ç—É–ø–∞—Ç—å –∫ —É—Å—Ç–∞–Ω–æ–≤–∫–µ aksusbd –∏
hasplm.

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ aksusbd

–î–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –¥—Ä–∞–π–≤–µ—Ä–∞ usb-–∫–ª—é—á–∞ –Ω–∞–¥–æ —Ä–∞–∑–º–µ—Å—Ç–∏—Ç—å –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ñ–∞–π–ª—ã –≤
—Å–∏—Å—Ç–µ–º–µ:

    root@linux# cp Redistribute/Runtime/script/aksusbd /usr/sbin/
    root@linux# cp Redistribute/Runtime/script/aksusbd.debian /etc/init.d/aksusbd
    root@linux# chmod u+rx /etc/init.d/aksusbd

–î–æ–±–∞–≤–∏–º LSB-–∑–∞–≥–æ–ª–æ–≤–∫–∏ –≤
<span style="font-family: monospace">/etc/init.d/aksusbd</span>:

    ### BEGIN INIT INFO
    # Provides:          aksusbd
    # Required-Start:    $local_fs
    # Required-Stop:
    # X-Start-Before     hasplm srv1cv82
    # X-Stop-After:      hasplm srv1cv82
    # Default-Start:     2 3 4 5
    # Default-Stop:      0 1 6
    ### END INIT INFO

–ò –∑–∞–ø—É—Å—Ç–∏–º insserv:

    root@linux# insserv aksusbd

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ hasplm

–î–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —É–ø—Ä–∞–≤–ª—è—é—â–µ–≥–æ –ª–∏—Ü–µ–Ω–∑–∏—è–º–∏ —Ç–∞–∫–∂–µ –Ω–∞–¥–æ —Ä–∞–∑–º–µ—Å—Ç–∏—Ç—å –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ
—Ñ–∞–π–ª—ã –≤ —Å–∏—Å—Ç–µ–º–µ:

    root@linux# cp Redistribute/LM/script/hasplm /usr/sbin/
    root@linux# cp Redistribute/LM/script/hasplm.debian /etc/init.d/hasplm
    root@linux# chmod u+rx /etc/init.d/hasplm

–î–æ–±–∞–≤–∏–º LSB-–∑–∞–≥–æ–ª–æ–≤–æ–∫ –≤
<span style="font-family: monospace">/etc/init.d/hasplm</span>:

    ### BEGIN INIT INFO
    # Provides:          hasplm
    # Required-Start:    $local_fs aksusbd
    # Required-Stop:     aksusbd
    # X-Start-Before     srv1cv82
    # X-Stop-After:      srv1cv82
    # Default-Start:     2 3 4 5
    # Default-Stop:      0 1 6
    ### END INIT INFO

–∏ –∑–∞–ø—É—Å—Ç–∏–º insserv:

    root@linux# insserv hasplm

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ 1–° –ü—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–µ

–î–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞ 1–° –ü—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω—É–∂–Ω—ã–µ
deb-–ø–∞–∫–µ—Ç—ã:

    root@linux# dpkg -i 1c-enterprise82-common_8.2.15-318_i386.deb
    root@linux# dpkg -i 1c-enterprise82-server_8.2.15-318_i386.deb
    root@linux# dpkg -i 1c-enterprise82-ws_8.2.15-318_i386.deb
    root@linux# dpkg -i 1c-enterprise82-crs_8.2.15-318_i386.deb

–î–∞–ª–µ–µ –∑–∞–ø—É—Å–∫–∞–µ–º —Å–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∏ –¥–æ—É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç—Ä–µ–±—É–µ–º—ã–µ
–ø–∞–∫–µ—Ç—ã:

    root@linux# /opt/1C/v8.2/i386/utils/config_server /usr/share/fonts/truetype

–í –Ω–∞—á–∞–ª–æ —Ñ–∞–π–ª–∞
<span style="font-family: monospace">/etc/init.d/srv1cv82</span> –ø–æ—Å–ª–µ
—á–µ–≥–æ –¥–æ–±–∞–≤–ª—è–µ–º LSB-–∑–∞–≥–æ–ª–æ–≤–æ–∫:

    ### BEGIN INIT INFO
    # Provides:          srv1cv82
    # Required-Start:    $local_fs $remote_fs aksusbd hasplm postgresql
    # Required-Stop:     aksusbd hasplm postgresql
    # X-Stop-After:
    # Default-Start:     2 3 4 5
    # Default-Stop:      0 1 6
    ### END INIT INFO

–∏ –∑–∞–ø—É—Å–∫–∞–µ–º insserv:

    root@linux# insserv srv1cv82

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞

–ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å –∫–æ–Ω—Å–æ–ª–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è 1–° —Å–æ–∑–¥–∞—Ç—å –Ω–∞
—Å–µ—Ä–≤–µ—Ä–µ –∫–ª–∞—Å—Ç–µ—Ä, —Å–µ—Ä–≤–µ—Ä –∏ —Ä–∞–±–æ—á–∏–µ –ø—Ä–æ—Ü–µ—Å—Å—ã.

### –í–∫–ª—é—á–µ–Ω–∏–µ –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–≥–æ –ñ—É—Ä–Ω–∞–ª–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º (–∞ —Ç–∞–∫–∂–µ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã) –º–æ–∂–µ—Ç
–ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è \[<http://v8.1c.ru/overview/Term_000000322.htm>|
–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –ñ—É—Ä–Ω–∞–ª\] (–¥–∞–ª–µ–µ –¢–ñ). –î–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è –¢–ñ —Å–æ–∑–¥–∞—ë–º
–∫–∞—Ç–∞–ª–æ–≥–∏ **/var/log/1c** –∏ **/var/log/1c/dumps** –∏ —Ñ–∞–π–ª
**/opt/1C/v8.2/i386/conf/logcfg.xml**:

    <config ns="http://v8.1c.ru/v8/tech-log">
            <dump create="true" location="/var/log/1c/dumps" prntscrn="true" type="2"/>
            <log history="72" location="/var/log/1c">
                    <event>
                            <eq property="name" value="EXCP"/>
                    </event>
                    <event>
                            <eq property="name" value="EXCPCNTX"/>
                    </event>
                    <event>
                            <eq property="name" value="PROC"/>
                    </event>
                    <event>
                            <eq property="name" value="ADMIN"/>
                    </event>
                    <event>
                            <eq property="name" value="MEM"/>
                    </event>
                    <event>
                            <eq property="name" value="LEAKS"/>
                    </event>
                    <property name="all"/>
            </log>
    </config>

–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º —Å–ª—É–∂–±—É.

## –ü—É–±–ª–∏–∫–∞—Ü–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã—Ö –±–∞–∑

–ù–∞ –ø—Ä–∏–º–µ—Ä–µ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞ Apache 2.2. –ü–æ—Å–ª–µ –±–∞–∑–æ–≤–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞
—Å–æ–∑–¥–∞—ë–º –∫–∞—Ç–∞–ª–æ–≥ **/srv/www/htdocs/unf** –∏ –∑–∞–ø—É—Å–∫–∞–µ–º –≤—Å—Ç—Ä–æ–µ–Ω–Ω—É—é —É—Ç–∏–ª–∏—Ç—É
–ø—É–±–ª–∏–∫–∞—Ü–∏–∏ (unf - –∏–º—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–π –±–∞–∑—ã –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ):

    root@linux# /opt/1C/v8.2/i386/webinst -apache22 -wsdir unf -dir '/srv/www/htdocs/unf/'
    \-connStr 'Srvr="hostname";Ref="unf";' -confPath /etc/apache2/conf.d/1cws.conf

–ü—Ä–∏ —ç—Ç–æ–º –¥–æ–ª–∂–µ–Ω —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å—Å—è —Ñ–∞–π–ª **/etc/apache2/conf.d/1cws.conf** —Å
–¥–∏—Ä–µ–∫—Ç–∏–≤–∞–º–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ **wsap22.so** –∏ –∞–ª–∏–∞—Å–æ–º –¥–ª—è
–ø–æ–¥–∫–ª—é—á–∞–µ–º–æ–≥–æ –ø—Ä–∏–∫–ª–∞–¥–Ω–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è (unf):

    LoadModule _1cws_module "/opt/1C/v8.2/i386/wsap22.so"

    # 1c publication
    Alias "/unf" "/srv/www/htdocs/unf/"
    <Directory "/srv/www/htdocs/unf/">
        AllowOverride None
        Options None
        Order allow,deny
        Allow from all
        SetHandler 1c-application
        ManagedApplicationDescriptor "/srv/www/htdocs/unf/default.vrd"
    </Directory>

VRD-—Ñ–∞–π–ª –¥–æ–ª–∂–µ–Ω –≤—ã–≥–ª—è–¥–µ—Ç—å —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º:

    <?xml version="1.0" encoding="UTF-8"?>
    <point ns="http://v8.1c.ru/8.2/virtual-resource-system"
            xmlns:xs="http://www.w3.org/2001/XMLSchema"
            xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
            base="/unf"
            ib="Srvr="hostname";Ref="unf";"/>

–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º –≤–µ–±-—Å–µ—Ä–≤–µ—Ä.

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–ª–∏–µ–Ω—Ç–∞

–ù–∞ —Å—Ç–æ—Ä–æ–Ω–µ –∫–ª–∏–µ–Ω—Ç–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Ñ–∞–π–ª
<span style="font-family: monospace">nethasp.ini</span>
(<span style="color: red">–î–æ–±–∞–≤–∏—Ç—å –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É</span>):

    [NH_COMMON]
    NH_TCPIP = Enabled
    ...
    [NH_TCPIP]
    NH_SERVER_ADDR = 192.168.100.202 //ip-–∞–¥—Ä–µ—Å –∫–æ–º–ø—å—é—Ç–µ—Ä–∞, –≥–¥–µ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω —É–ø—Ä–∞–≤–ª—è—é—â–∏–π –ª–∏—Ü–µ–Ω–∑–∏—è–º–∏.
    NH_TCPIP_METHOD = UDP
    NH_USE_BROADCAST = Disabled

## –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–µ–∏—Å–ø—Ä–∞–≤–Ω–æ—Å—Ç–µ–π

  - –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–π –±–∞–∑—ã –ø–æ—è–≤–ª—è–µ—Ç—Å—è –æ—à–∏–±–∫–∞ —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º –ø—Ä–æ
    lc_messages
      -
        –ù–µ–æ–±—Ö–æ–¥–∏–º–æ —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –ª–æ–∫–∞–ª—å
        <span style="font-family: monospace">/usr/lib/locale/en_US.UTF-8</span>
        –∏ —Å–∏–º–≤–æ–ª—å–Ω—ã–µ —Å—Å—ã–ª–∫–∏ en_US –∏ en –Ω–∞ –Ω–µ—ë —Å—É—â–µ—Å—Ç–≤—É—é—Ç ([\#–£—Å—Ç–∞–Ω–æ–≤–∫–∞
        –ø—Ä–æ—á–µ–≥–æ –ü–û](#–£—Å—Ç–∞–Ω–æ–≤–∫–∞_–ø—Ä–æ—á–µ–≥–æ_–ü–û "wikilink"));

<!-- end list -->

  - –ü—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ 1–° –≤—ã–¥–∞—ë—Ç –æ—à–∏–±–∫—É, —á—Ç–æ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É–µ—Ç
    –∫–∞–∫–æ–π-—Ç–æ sql-—Ñ—É–Ω–∫—Ü–∏–∏
      -
        –°—Ç—Ä–∞–Ω–Ω–æ, –Ω–æ —Ç–∞–∫ –±—ã–≤–∞–µ—Ç, —á—Ç–æ –≤ –∫–∞–∫–æ–π-—Ç–æ –≤–µ—Ä—Å–∏–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
        –∑–∞–±—ã–≤–∞—é—Ç –ø–æ–ª–æ–∂–∏—Ç—å –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏. –ù–∞–¥–æ –≤—ã–±—Ä–∞—Ç—å
        –ø—Ä–µ–¥—ã–¥—É—â—É—é –≤–µ—Ä—Å–∏—é –∏–ª–∏ –±–æ–ª–µ–µ —Ä–∞–Ω–Ω—é—é, –≥–¥–µ –¥–∞–Ω–Ω–æ–π –æ—à–∏–±–∫–∏ –Ω–µ
        –≤–æ–∑–Ω–∏–∫–∞–µ—Ç, –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –µ—ë; –ø–æ—Å–ª–µ —á–µ–≥–æ –æ–±–Ω–æ–≤–∏—Ç—å –µ—ë –¥–æ
        –ø–æ—Å–ª–µ–¥–Ω–µ–π.