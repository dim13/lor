## –ß—Ç–æ —Ç–∞–∫–æ–µ XPCOM

**XPCOM** - –ö—Ä–æ—Å—Å–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω–∞—è –ö–æ–º–ø–æ–Ω–µ–Ω—Ç–Ω–∞—è –û–±—ä–µ–∫—Ç–Ω–∞—è –ú–æ–¥–µ–ª—å (Cross
Platform Component Object Model). –î–∞–Ω–Ω–∞—è –º–æ–¥–µ–ª—å —Å—Ö–æ–∂–∞ —Å –Ω–µ–±–µ–∑—ã–∑–≤–µ—Å—Ç–Ω—ã–º
COM –≤ –û–° Windows, –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π –º–µ—Ö–∞–Ω–∏–∑–º —Å–æ–∑–¥–∞–Ω–∏—è –∏ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–π
–∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –≤ –í–∞—à—É –ø—Ä–æ–≥—Ä–∞–º–º—É. –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –æ–±—ã—á–Ω–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç
—Å–æ–±–æ–π –Ω–µ–∫–∏–π –∫–ª–∞—Å—Å, –æ–±—ä–µ–∫—Ç –∫–æ—Ç–æ—Ä–æ–≥–æ –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤
–ø—Ä–æ–≥—Ä–∞–º–º–µ. –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã XPCOM –º–æ–≥—É—Ç –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã –∏–∑ —è–∑—ã–∫–æ–≤ C, C++,
JavaScript. –í –æ—Ç–ª–∏—á–∏–µ –æ—Ç –ø—Ä—è–º–æ–π –ª–∏–Ω–∫–æ–≤–∫–∏ –≤ –±–∏–±–ª–∏–æ—Ç–µ–∫–æ–π, –∫–∞–∫ –Ω–∞–ø—Ä–∏–º–µ—Ä —ç—Ç–æ
–æ–±—ã—á–Ω–æ –¥–µ–ª–∞–µ—Ç—Å—è –≤ —è–∑—ã–∫–µ C++ (g++ -o program -lsomelib), –º–µ—Ö–∞–Ω–∏–∑–º XPCOM
–ø–æ–ª–Ω–æ—Å—Ç—å—é –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π, –∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–¥–≥—Ä—É–∂–∞—Ç—å –Ω–æ–≤—ã–µ —Ç–∏–ø—ã –≤–æ –≤—Ä–µ–º—è
–≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–∞–º–º—ã. XPCOM –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –º–æ–≥—É—Ç –±—ã—Ç—å –Ω–∞–ø–∏—Å–∞–Ω—ã –∫–∞–∫ –Ω–∞
C++, —Ç–∞–∫ –∏ –Ω–∞ JavaScript. –ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –≤
JavaScript –≤ XUL –µ—Å—Ç—å –Ω–∏ —á—Ç–æ –∏–Ω–æ–µ, –∫–∞–∫ XPCOM –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã.

–ü—Ä–∏ –Ω–∞–ø–∏—Å–∞–Ω–∏–∏ XPCOM –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –Ω—É–∂–Ω–æ –∑–Ω–∞—Ç—å —á–µ—Ç—ã—Ä–µ –ø–æ–Ω—è—Ç–∏—è:

  - **–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å** - –Ω–∞–±–æ—Ä –º–µ—Ç–æ–¥–æ–≤ –∏ –∞—Ç—Ä–∏–±—É—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –∫–∞–∫-—Ç–æ –ª–æ–≥–∏—á–µ—Å–∫–∏
    —Å–≤—è–∑–∞–Ω—ã –¥—Ä—É–≥ —Å –¥—Ä—É–≥–æ–º;
  - **–∫–æ–º–ø–æ–Ω–µ–Ω—Ç** - —ç—Ç–æ –æ–±—ä–µ–∫—Ç, —Ä–µ–∞–ª–∏–∑—É—é—â–∏–π –æ–¥–∏–Ω –∏–ª–∏ –±–æ–ª—å—à–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤;
  - **—Ñ–∞–±—Ä–∏–∫–∞** - –æ–±—ä–µ–∫—Ç (–∏–ª–∏ —Ñ—É–Ω–∫—Ü–∏—è), —Å–æ–∑–¥–∞—é—â–∏–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã, —Ä–µ–∞–ª–∏–∑—É–µ—Ç
    –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
    [nsIFactory](http://developer.mozilla.org/en/docs/nsIFactory);
  - **–º–æ–¥—É–ª—å** - –æ–±—ä–µ–∫—Ç, —É–ø—Ä–∞–≤–ª—è—â–∏–π –Ω–∞–±–æ—Ä–æ–º —Ñ–∞–±—Ä–∏–∫, —Ä–µ–∞–ª–∏–∑—É–µ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
    [nsIModule](http://developer.mozilla.org/en/docs/nsIModule).

–°—Ç–æ–∏—Ç –æ—Ç–º–µ—Ç–∏—Ç—å, —á—Ç–æ —ç—Ç–∏ –ø–æ–Ω—è—Ç–∏—è —Å–≤—è–∑–∞–Ω—ã –Ω–µ —Ç–æ–ª—å–∫–æ —Å XPCOM, –∞ —Å
–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–Ω—ã–º –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ–º –≤–æ–æ–±—â–µ. –≠—Ç–∏ –∂–µ –ø–æ–Ω—è—Ç–∏—è –≤—ã
–º–æ–∂–µ—Ç–µ –≤—Å—Ç—Ä–µ—Ç–∏—Ç—å, –Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å *D-Bus*. –í *D-Bus* —Ä–æ–ª—å
–º–æ–¥—É–ª—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç –ø—Ä–æ–≥—Ä–∞–º–º–∞, —Å–æ–∑–¥–∞—é—â–∞—è –∫–æ—Ä–Ω–µ–≤–æ–π dbus —Å–µ—Ä–≤–∏—Å (–ø–æ
–∞–Ω–∞–ª–æ–≥–∏–∏ —Å —Ñ–∞–±—Ä–∏–∫–æ–π), —Ä–æ–ª—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –≤—ã–ø–æ–ª–Ω—è—é—Ç –¥–æ—á–µ—Ä–Ω–∏–µ dbus
–æ–±—ä–µ–∫—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ —Å XPCOM –º–æ–≥—É—Ç —Ä–µ–∞–ª–∏–∑–æ–≤—ã–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ
–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤.

## –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞

–î–ª—è –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ XPCOM –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä, –Ω–∞–±–æ—Ä —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—
–∑–∞–≥–æ–ª–æ–≤–æ—á–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤, –Ω–∞–±–æ—Ä –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (SDK) –¥–ª—è XUL. –î–ª—è
–¥–∏—Å—Ç—Ä–∏–±—É—Ç–∏–≤–æ–≤, –æ—Å–Ω–æ–≤–∞–Ω–Ω—ã—Ö –Ω–∞ Debian, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
–ø–∞–∫–µ—Ç—ã build-essential, xulrunner-1.9-dev. Xulrunner-1.9 —É –í–∞—Å —É–∂–µ
–¥–æ–ª–∂–µ–Ω —Å—Ç–æ—è—Ç—å.

–í Makefile –≤ –∏—Å—Ö–æ–¥–Ω–∏–∫–∞—Ö –ø—Ä–∏–º–µ—Ä–∞ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é GECKO_SDK_PATH
—Ä–∞–≤–Ω–æ–π –ø—É—Ç–∏ –∫ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º –∏ IDL —Ñ–∞–π–ª–æ–∞–º xulrunner. –í KUbuntu Gutsy —ç—Ç–æ
/usr/lib/xulrunner-devel-1.9a8. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ø—É—Ç—å, –∫—É–¥–∞ —É—Å—Ç–∞–Ω–æ–≤–∏–ª–∏—Å—å —Ñ–∞–π–ª—ã
–∏–∑ –ø–∞–∫–µ—Ç–∞ xulrunner-1.9-dev (dpkg -L xulrunner-1.9-dev), —Ç–∞–º –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å
–∫–∞—Ç–∞–ª–æ–≥–∏ include, idl, bin, lib - —ç—Ç–æ—Ç –ø—É—Ç—å –∏ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤
GECKO_SDK_PATH. –î–ª—è —Ä–∞–±–æ—Ç—ã –∏–∑ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏, –º–æ–∂–Ω–æ —Ç–∞–∫–∂–µ —Å–¥–µ–ª–∞—Ç—å

    <nowiki>
    # export XUL=/usr/lib/xulrunner-devel-1.9a8
    </nowiki>

–¢–µ–ø–µ—Ä—å –º—ã —Å–º–æ–∂–µ–º –±—ã—Å—Ç—Ä–æ –≤—ã–∑–≤–∞—Ç—å –∫–∞–∫—É—é-–Ω–∏–±—É–¥—å —É—Ç–∏–ª–∏—Ç—É –∏–∑ –∫–æ–º–ø–ª–µ–∫—Ç–∞
—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ XUL, –Ω–∞–ø—Ä–∏–º–µ—Ä:

    <nowiki>
    # $XUL/bin/xpidl

    ERROR: must specify output mode
    Usage: /usr/lib/xulrunner-devel-1.9a8/bin/xpidl -m mode [-w] [-v] [-t version number] [-d filename.pp]
    ...
    </nowiki>

–í –¥–∞–Ω–Ω–æ–º –ø—Ä–∏–º–µ—Ä–µ –º—ã —Ä–∞—Å—Å–º–æ—Ç—Ä–∏–º –ø—Ä–æ—Å—Ç–µ–π—à–∏–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π —Å–∫–ª–∞–¥—ã–≤–∞–µ—Ç
–¥–≤–∞ —á–∏—Å–ª–∞ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç.

## –°–æ–∑–¥–∞—ë–º GUID

–î–ª—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–∑–¥–∞—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä,
GUID. –ò—Å–ø–æ–ª—å–∑—É–µ–º —É—Ç–∏–ª–∏—Ç—É **uuidgen** –∏–∑ –ø–∞–∫–µ—Ç–∞ **e2fsprogs**.

## –°–æ–∑–¥–∞—ë–º —Ñ–∞–π–ª —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –Ω–∞—à–µ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ (IDL)

–í XPCOM –¥–ª—è –æ–ø–∏—Å–∞–Ω–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞, –Ω–∞–∑—ã–≤–∞–µ–º—ã–π
[XPIDL](http://www.mozilla.org/scriptable/xpidl/idl-authors-guide),
—Å—Ö–æ–∂–∏–π —Å IDL –∏–∑ CORBA. –í —ç—Ç–æ–º —Ñ–∞–π–ª–µ –æ–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –∏–º—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞, –µ–≥–æ
–º–µ—Ç–æ–¥—ã, –∞—Ç—Ä–∏–±—É—Ç—ã, —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä, –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –∏ –¥—Ä—É–≥–æ–µ. –í
–Ω–∞—à–µ–º —Å–ª—É—á–∞–µ:

    <nowiki>
    #include "nsISupports.idl"

    [scriptable, uuid(_YOUR_INTERFACE_GUID_)]
    interface IMyComponent : nsISupports
    {
      // –¢–æ–ª—å–∫–æ –æ–¥–∏–Ω –º–µ—Ç–æ–¥, –¥–ª—è —Å–ª–æ–∂–µ–Ω–∏—è —á–∏—Å–µ–ª
      long Add(in long a, in long b);
    };
    </nowiki>

–ú—ã –æ–ø–∏—Å–∞–ª–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å –∏–º–µ–Ω–µ–º **IMyComponent**, –∏–º–µ—é—â–∏–π –≤—Å–µ–≥–æ –ª–∏—à—å –æ–¥–∏–Ω
–º–µ—Ç–æ–¥ –¥–ª—è —Å–ª–æ–∂–µ–Ω–∏—è —á–∏—Å–µ–ª. –í–º–µ—Å—Ç–æ **_YOUR_INTERFACE_GUID_**
–≤—Å—Ç–∞–≤–ª—è–µ–º —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–∞–Ω–µ–µ GUID. –ù–∞—à –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–æ–ª–∂–µ–Ω
–Ω–∞—Å–ª–µ–¥–æ–≤–∞—Ç—å—Å—è –æ—Ç –±–∞–∑–æ–≤–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
[nsISupports](http://developer.mozilla.org/en/nsISupports), –∫–æ—Ç–æ—Ä—ã–π
–∏–º–µ–µ—Ç –æ–±—â—É—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –¥–ª—è –≤—Å–µ—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ - –º–µ—Ç–æ–¥—ã
**AddRef**, **QueryInterface** –∏ **Release** (–∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É
**IUnknown** –≤ COM). –ú–µ—Ç–æ–¥ **AddRef** —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π —Å—á—ë—Ç—á–∏–∫ –Ω–∞
1 –ø—Ä–∏ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–∏ —É–∫–∞–∑–∞—Ç–µ–ª—è –Ω–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å. **Release** —Å–ª—É–∂–∏—Ç –¥–ª—è
—É–º–µ–Ω—å—à–µ–Ω–∏—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ —Å—á—ë—Ç—á–∏–∫–∞ –Ω–∞ 1, –∫–æ–≥–¥–∞ –æ–¥–∏–Ω –∏–∑ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã—
—É–∫–∞–∑–∞—Ç–µ–ª–µ–π –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–µ–Ω. –ï—Å–ª–∏ —Å—á—ë—Ç—á–∏–∫ —Ä–∞–≤–µ–Ω 0, —Ç–æ **Release**
–±–µ–∑–∂–∞–ª–æ—Å—Ç–Ω–æ —É–¥–∞–ª—è–µ—Ç —Å–∞–º–æ–≥–æ —Å–µ–±—è (–æ–±—ä–µ–∫—Ç this).
**QueryInterface** —Å–ª—É–∂–∏—Ç –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —É–∫–∞–∑–∞—Ç–µ–ª—è –Ω–∞ –æ–¥–∏–Ω –∏–∑
–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ (—Å —É–≤–µ–ª–∏—á–µ–Ω–∏–µ–º —Å—á—ë—Ç—á–∏–∫–∞, –µ—Å–ª–∏
–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –Ω–∞–π–¥–µ–Ω), –ø–æ–ª–∞–≥–∞—è—Å—å –Ω–∞ –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–π –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∞—Ä–≥—É–º–µ–Ω—Ç–∞
–∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫—Ç–æ—Ä.

–ö–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ **scriptable** —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ —Ç–æ, —á—Ç–æ –º—ã –º–æ–∂–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å
—ç—Ç–æ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∏–∑ —Å–∫—Ä–∏–ø—Ç–æ–≤–æ–≥–æ —è–∑—ã–∫–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä JavaScript. –ë–µ–∑ —É–∫–∞–∑–∞–Ω–∏—è
—ç—Ç–æ–≥–æ –∫–ª—é—á–µ–≤–æ–≥–æ —Å–ª–æ–≤–∞ –º—ã –Ω–µ —Å–º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–∞—à –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∏–∑
JavaScript.

–°–æ—Ö—Ä–∞–Ω—è–µ–º —ç—Ç–æ—Ç —Ñ–∞–π–ª –∫–∞–∫ *IMyComponent.idl*.

## –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∑–∞–≥–æ–ª–æ–≤–∫–∞ –∏ xpt –±–∏–±–ª–∏–æ—Ç–µ–∫–∏

–¢–µ–ø–µ—Ä—å –Ω–∞–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∏–∑ –æ–ø–∏—Å–∞–Ω–∏—è –Ω–∞—à–µ–≥–æ –∏–Ω—Ç—Ä–µ—Ñ–µ–π—Å–∞, XPIDL —Ñ–∞–π–ª–∞,
—Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∑–∞–≥–æ–ª–æ–≤–æ—á–Ω—ã–π —Ñ–∞–π–ª, –∫–æ—Ç–æ—Ä—ã–π –º—ã –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å
–¥–∞–ª–µ–µ –ø—Ä–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –º–µ—Ç–æ–¥–æ–≤, –∏ .xpt –±–∏–±–ª–∏–æ—Ç–µ–∫—É. XPT –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ - —ç—Ç–æ
–±–∏–Ω–∞—Ä–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è —Ñ–∞–π–ª–∞ –æ–ø–∏—Å–∞–Ω–∏—è XPIDL, –æ–Ω–∞ –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ —Å–æ–¥–µ—Ä–∂–∏—Ç –∏–º—è
–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞, –µ–≥–æ –º–µ—Ç–æ–¥—ã, –∞—Ç—Ä–∏–±—É—Ç—ã, —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∏ —Ç.–¥.,
—Ç–æ–ª—å–∫–æ –≤ –±–∏–Ω–∞—Ä–Ω–æ–º –≤–∏–¥–µ, —á—Ç–æ –æ–±–ª–µ–≥—á–∞–µ—Ç –∂–∏–∑–Ω—å –∑–∞–≥—Ä—É–∑—á–∏–∫—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
(XPConnect).

–°–ª–µ–¥—É—é—â–∏–µ —Å—Ç—Ä–æ–∫–∏ –Ω–µ —è–≤–ª—è—é—Ç—Å—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º–∏, —Ç.–∫. –æ–Ω–∏ —É–∂–µ –≤–Ω–µ—Å–µ–Ω—ã –≤
Makefile –∏–∑ –ø—Ä–∏–º–µ—Ä–∞, –Ω–æ –≤—Å—ë-—Ç–∞–∫–∏ –Ω–µ –ø–æ–º–µ—à–∞–µ—Ç –∑–Ω–∞—Ç—å, –∫–∞–∫ —ç—Ç–æ –¥–µ–ª–∞–µ—Ç—Å—è.

–ò—Ç–∞–∫, –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∑–∞–≥–æ–ª–æ–≤–æ—á–Ω—ã–π —Ñ–∞–π–ª:

    <nowiki>
    # $XUL/bin/xpidl -m header -I$XUL/idl IMyComponent.idl
    </nowiki>

–°–æ–∑–¥–∞—ë—Ç—Å—è —Ñ–∞–π–ª *IMyComponent.h*.

    <nowiki>
    # $XUL/bin/xpidl -m typelib -I$XUL/idl IMyComponent.idl
    </nowiki>

–°–æ–∑–¥–∞—ë—Ç—Å—è —Ñ–∞–π–ª *IMyComponent.xpt*.

## –°–æ–∑–¥–∞—ë–º —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞

–°–æ–∑–¥–∞—ë–º —Ñ–∞–π–ª *MyComponent.h* - –∑–¥–µ—Å—å –±—É–¥–µ—Ç –æ–±—ä—è–≤–ª–µ–Ω–∏–µ (definition)
–∫–ª–∞—Å—Å–∞ –Ω–∞—à–µ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞:

    <nowiki>
    #ifndef _MY_COMPONENT_H_
    #define _MY_COMPONENT_H_

    #include "IMyComponent.h"

    // –°—Ç—Ä–æ–∫–∞-–∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –Ω–∞—à–µ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞, —Ç.–Ω. Contract ID. –ò—Å–ø–æ–ª—å–∑—É—è —ç—Ç–æ —Å—Ç—Ä–æ–∫—É –º—ã —Å–º–æ–∂–µ–º –∑–∞–≥—Ä—É–∑–∏—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç.
    // –û–±—ã—á–Ω–æ —ç—Ç–∞ —Å—Ç—Ä–æ–∫–∞ –∏–º–µ–µ—Ç –∫–∞–∫–æ–π-—Ç–æ –æ—Å–º—ã—Å–ª–µ–Ω–Ω—ã–π –≤–∏–¥, –∫—É–¥–∞ –≤–Ω–æ—Å–∏—Ç—Å—è –¥–æ–º–µ–Ω, –∏–º—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞, –≤–µ—Ä—Å–∏—è.
    #define MY_COMPONENT_CONTRACTID "@mydomain.com/XPCOMSample/MyComponent;1"

    // –ò–º—è –∫–ª–∞—Å—Å–∞
    #define MY_COMPONENT_CLASSNAME  "A Simple XPCOM Sample"

    // –£–Ω–∏–∫–∞–ª—å–Ω—ã–π 128-–±–∏—Ç–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞, –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—É –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞, —Ç–æ–ª—å–∫–æ
    // –≤ –±–∏–Ω–∞—Ä–Ω–æ–º –≤–∏–¥–µ.
    #define MY_COMPONENT_CID        { 0x597a60b0, 0x5272, 0x4284, { 0x90, 0xf6, 0xe9, 0x6c, 0x24, 0x2d, 0x74, 0x6 } }

    // –û–±—ä—è–≤–ª—è–µ–º –∫–ª–∞—Å—Å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞, –Ω–∞—Å–ª–µ–¥—É–µ–º—Å—è –æ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∫–ª–∞—Å—Å–∞ IMyComponent.
    class MyComponent : public IMyComponent
    {
    public:

      // –≠—Ç–æ—Ç –º–∞–∫—Ä–æ—Å –≤—Å—Ç–∞–≤–ª—è–µ—Ç –æ–±—ä—è–≤–ª–µ–Ω–∏–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö —Ç—Ä—ë—Ö public –º–µ—Ç–æ–¥–æ–≤ –∏–∑ nsISupports,
      // –∏ protected –∞—Ç—Ä–∏–±—É—Ç–∞-—Å—á—ë—Ç–∏–∫–∞ —Å—Å—ã–ª–æ–∫.
      NS_DECL_ISUPPORTS

      // –≠—Ç–æ—Ç –º–∞–∫—Ä–æ—Å –≤—Å—Ç–∞–≤–ª—è–µ—Ç –æ–±—ä—è–≤–ª–µ–Ω–∏–µ –Ω–∞—à–µ–≥–æ –º–µ—Ç–æ–¥–∞ Add().
      NS_DECL_IMYCOMPONENT

      MyComponent();
      virtual ~MyComponent();
    };

    #endif //_MY_COMPONENT_H_
    </nowiki>

–°–æ–∑–¥–∞—ë–º —Ñ–∞–π–ª *MyComponent.cpp* - –∑–¥–µ—Å—å –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∫–ª–∞—Å—Å–∞ –Ω–∞—à–µ–≥–æ
–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞:

    <nowiki>
    #include "MyComponent.h"

    // –≠—Ç–æ—Ç –º–∞–∫—Ä–æ—Å –≤—Å—Ç–∞–≤–ª—è–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –º–µ—Ç–æ–¥–æ–≤ AddRef(), Release() –∏ QueryInterface().
    // –ü–∞—Ä–∞–º–µ—Ç—Ä—ã - –∫–ª–∞—Å—Å –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å.
    NS_IMPL_ISUPPORTS1(MyComponent, IMyComponent)

    MyComponent::MyComponent()
    {}

    MyComponent::~MyComponent()
    {}

    // –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –º–µ—Ç–æ–¥–∞ Add()
    NS_IMETHODIMP MyComponent::Add(PRInt32 a, PRInt32 b, PRInt32 *_retval)
    {
            *_retval = a + b;
            return NS_OK;
    }
    </nowiki>

## –°–æ–∑–¥–∞—ë–º –∫–æ–¥ –¥–ª—è –∑–∞–≥—Ä—É–∑—á–∏–∫–∞

–°–æ–∑–¥–∞—ë–º —Ñ–∞–π–ª *MyComponentModule.cpp*, –≥–¥–µ –±—É–¥–µ—Ç –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è
–∑–∞–≥—Ä—É–∑—á–∏–∫–∞ –Ω–∞—à–µ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞:

    <nowiki>
    #include "nsIGenericFactory.h"
    #include "MyComponent.h"

    // –°–æ–∑–¥–∞—ë–º –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä (—Ñ–∞–±—Ä–∏–∫—É) –Ω–∞—à–µ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞. –≠—Ç–æ—Ç –º–∞–∫—Ä–æ—Å
    // —Å–æ–∑–¥–∞—ë—Ç static —Ñ—É–Ω–∫—Ü–∏—é —Å –∏–º–µ–Ω–µ–º <–∏–º—è_–∞—Ä–≥—É–º–µ–Ω—Ç–∞>Constructor, –≤ –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ
    // MyComponentConstructor, –∫–æ—Ç–æ—Ä–∞—è –¥–∞–ª–µ–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ components.
    NS_GENERIC_FACTORY_CONSTRUCTOR(MyComponent)

    // –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –Ω–∞—à–µ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
    static nsModuleComponentInfo components[] =
    {
        {
           MY_COMPONENT_CLASSNAME,
           MY_COMPONENT_CID,
           MY_COMPONENT_CONTRACTID,
           MyComponentConstructor,
        }
    };

    // –°–æ–∑–¥–∞—ë–º —Ç–æ—á–∫—É –≤—Ö–æ–¥–∞ —Å –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π. –≠—Ç–æ –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ extern "C" —Ñ—É–Ω–∫—Ü–∏—è–º
    // –≤ –°++ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞—Ö, –∑–∞–≥—Ä—É–∂–∞–µ–º—ã—Ö —á–µ—Ä–µ–∑ dlopen(), –∏ –∫–æ—Ç–æ—Ä—ã–µ —Å–æ–∑–¥–∞—é—Ç –∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç —É–∫–∞–∑–∞—Ç–µ–ª—å
    // –Ω–∞ –æ–±—ä–µ–∫—Ç –∫–ª–∞—Å—Å–∞.
    NS_IMPL_NSGETMODULE("MyComponentsModule", components)
    </nowiki>

–í–µ—Å—å –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–π –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ –Ω–∞–ø–∏—Å–∞–Ω, —Ç–µ–ø–µ—Ä—å —Å–æ–∑–¥–∞–¥–∏–º —Ñ–∞–π–ª —Å–±–æ—Ä–∫–∏ -
*Makefile*.

## Makefile

–°–æ–∑–¥–∞—ë–º —Ñ–∞–π–ª *Makefile*, –Ω–µ –∑–∞–±—ã–≤–∞–µ–º –ø–æ–ø—Ä–∞–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é
**GECKO_SDK_PATH**.

    <nowiki>
    CXX = g++
    CPPFLAGS += -fno-rtti -fno-exceptions -shared

    GECKO_SDK_PATH = /usr/lib/xulrunner-devel-1.9a8

    GECKO_CONFIG_INCLUDE = -include mozilla-config.h

    GECKO_DEFINES  = -DXPCOM_GLUE -DXPCOM_GLUE_USE_NSPR

    GECKO_INCLUDES = -I$(GECKO_SDK_PATH)/include -I$(GECKO_SDK_PATH)/sdk/include

    GECKO_LDFLAGS =  -L$(GECKO_SDK_PATH)/lib -lxpcomglue_s -lxul -lxpcom -lplds4 -lplc4 -lnspr4 -lpthread -ldl

    FILES = MyComponent.cpp MyComponentModule.cpp

    TARGET = MyComponent.so

    build:
            $(GECKO_SDK_PATH)/bin/xpidl -m header  -I$(GECKO_SDK_PATH)/idl IMyComponent.idl
            $(GECKO_SDK_PATH)/bin/xpidl -m typelib -I$(GECKO_SDK_PATH)/idl IMyComponent.idl
            $(CXX) -Wall -O2 -o $(TARGET) $(GECKO_CONFIG_INCLUDE) $(GECKO_DEFINES) $(GECKO_INCLUDES) $(CPPFLAGS) $(CXXFLAGS) $(FILES) $(GECKO_LDFLAGS)
            chmod +x $(TARGET)
            strip $(TARGET)

    clean:
            rm -f IMyComponent.xpt
            rm -f IMyComponent.h
            rm -f $(TARGET)
    </nowiki>

## –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫

–ú—ã —Å–æ–∑–¥–∞–ª–∏ –≤—Å—ë –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–µ –¥–ª—è —Å–±–æ—Ä–∫–∏ XPCOM –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞. –¢–µ–ø–µ—Ä—å –ø—Ä–æ—Å—Ç–æ
–∏—Å–ø–æ–ª—å–∑—É–µ–º —É—Ç–∏–ª–∏—Ç—É *make* –¥–ª—è —Å–±–æ—Ä–∫–∏:

    <nowiki>
    # make
    </nowiki>

–ï—Å–ª–∏ –≤—Å—ë –ø—Ä–æ—à–ª–æ —É–¥–∞—á–Ω–æ, —Å–æ–∑–¥–∞—Å—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞
*MyComponent.so*. –≠—Ç—É –±–∏–±–ª–∏–æ—Ç–µ–∫—É –∏ .xpt —Ñ–∞–π–ª –∫–æ–ø–∏—Ä—É–µ–º –≤ –∫–∞—Ç–∞–ª–æ–≥
**components** –Ω–∞—à–µ–≥–æ XUL –ø—Ä–æ–µ–∫—Ç–∞, –∏ –≤ –ø—Ä–æ–µ–∫—Ç–µ —Å–æ–∑–¥–∞—ë–º .xul —Ñ–∞–π–ª
–Ω–∞–ø–æ–¥–æ–±–∏–µ:

    <nowiki>
    <?xml version="1.0"?>
    <?xml-stylesheet href="chrome://global/skin/" type="text/css"?>

    <window
        title="Example"
        width="320"
        height="200"
        ns="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul">

    <label id="result" />

    <script type="application/x-javascript">

    function MyComponentTest()
    {
        var obj = null;

        try
        {
            // –ü–æ Contract ID –ø–æ–ª—É—á–∞–µ–º –¥–æ—Å—Ç—É–ø –∫ –º–æ–¥—É–ª—é
            const cid = "@mydomain.com/XPCOMSample/MyComponent;1";
            obj = Components.classes[cid].createInstance();

            // –ü–æ–ª—É—á–∞–µ–º —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ –æ–±—ä–µ–∫—Ç –Ω–∞—à–µ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
            obj = obj.QueryInterface(Components.interfaces.IMyComponent);
        }
        catch(err)
        {
            alert(err);
            return;
        }

        // –í—ã–∑—ã–≤–∞–µ–º –Ω–∞—à –º–µ—Ç–æ–¥ –¥–ª—è —Å–ª–æ–∂–µ–Ω–∏—è —á–∏—Å–µ–ª
        var res = obj.Add(3, 4);

        document.getElementById("result").value = "3 + 4 = " + res;
    }

    MyComponentTest();

    </script>
    </window>
    </nowiki>

–ó–∞–ø—É—Å–∫–∞–µ–º:

    <nowiki>
    # xulrunner ./application.ini
    </nowiki>

–í—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å –æ–∫–Ω–æ —Å —Ç–µ–∫—Å—Ç–æ–º **3 + 4 = 7** –≤–Ω—É—Ç—Ä–∏.

–ò—Å—Ö–æ–¥–Ω–∏–∫–∏ XUL –ø—Ä–æ–µ–∫—Ç–∞ –∏ XPCOM –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –ø—Ä–∏–≤–µ–¥–µ–Ω—ã –Ω–∏–∂–µ.

## –°—Å—ã–ª–∫–∏

  - ![–ò—Å—Ö–æ–¥–Ω–∏–∫–∏ example3 —Å –≥–æ—Ç–æ–≤—ã–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–º (–ø–µ—Ä–µ–∏–º–µ–Ω—É–π—Ç–µ –≤
    .tar.bz2)](example3.tar.bz2
    "–ò—Å—Ö–æ–¥–Ω–∏–∫–∏ example3 —Å –≥–æ—Ç–æ–≤—ã–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–º (–ø–µ—Ä–µ–∏–º–µ–Ω—É–π—Ç–µ –≤ .tar.bz2)")
  - ![–ò—Å—Ö–æ–¥–Ω–∏–∫–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞](xpcom-sample.tar.bz2 "–ò—Å—Ö–æ–¥–Ω–∏–∫–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞")
  - [–û—Ä–∏–≥–∏–Ω–∞–ª —Å—Ç–∞—Ç—å–∏ –Ω–∞
    –∞–Ω–≥–ª–∏–π—Å–∫–æ–º](http://www.iosart.com/firefox/xpcom/)
  - [–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø–æ XPConnect –æ—Ç
    Mozilla](http://www.mozilla.org/scriptable/)
  - [–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø–æ XPCOM –æ—Ç
    Mozilla](http://www.mozilla.org/projects/xpcom/index.html)
  - [–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø–æ
    XPCOM](http://www.mozilla.org/projects/xpcom/book/cxc/html/index.html)
  - [–ï—â—ë –ø—Ä–∏–º–µ—Ä –ø–æ
    XPCOM](http://lxr.mozilla.org/seamonkey/source/xpcom/sample/)
  - [–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø–æ XPIDL –æ—Ç
    Mozilla](http://www.mozilla.org/scriptable/xpidl/idl-authors-guide/)

*–≠—Ç–æ —Å—Ç–∞—Ç—å—è –æ—Å–Ω–æ–≤–∞–Ω–∞ –Ω–∞ –ø—Ä–∏–º–µ—Ä–µ –ø–æ XPCOM –æ—Ç Alex Sirota. –†–µ–¥–∞–∫—Ü–∏—è –¥–ª—è
–∑–∞–ø—É—Å–∫–∞ –ø–æ–¥ xulrunner-1.9, —Ç–µ–∫—Å—Ç —Ä–∞–∑–¥–µ–ª–æ–≤ –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤ –°++ –∏
JavaScript –∫–æ–¥–µ –Ω–∞ —ç—Ç–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è Alex Custov.*

[Category:XUL](Category:XUL "wikilink")